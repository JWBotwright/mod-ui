--- mod-ui-launcher	2024-08-11 19:18:17.368999745 +0100
+++ mod-ui-launcher	2024-08-11 21:48:58.502933105 +0100
@@ -0,0 +1,147 @@
+#!/bin/bash
+
+# Copy this to your .bash_profile and amend JACKD_ARGS for your setup
+# /bin/uname -r | grep -q rt
+# if [ $? -eq 0 ]
+# then
+#   # Start jackd under RT kernel
+#   export JACKD_ARGS="-R -d alsa -p 128 -n 1 -r 48000 -d hw:0"
+# else
+#   # Start jackd under non-RT kernel
+#   export JACKD_ARGS="-r -d alsa -p 256 -n 2 -r 48000 -d hw:0"
+# fi
+
+msgbox_start () {
+  if [ -z "$DISPLAY" ]; then
+    echo "0" | dialog --gauge "Starting mod-ui" 10 70 0
+  else
+    msgbox=`kdialog --progressbar "Starting mod-ui" 100`
+  fi
+}
+
+msgbox_update () {
+  if [ -z "$DISPLAY" ]; then
+    echo $1 | dialog --gauge "Starting mod-ui" 10 70 0
+  else
+    qdbus $msgbox Set "" value $1
+  fi
+}
+
+msgbox_wait () {
+  if [ -z "$DISPLAY" ]; then
+    dialog --msgbox "Please open your web browser to http://localhost:8888" 10 70
+    dialog --msgbox "Press OK to end mod-ui" 10 70
+  else
+    xdg-open http://localhost:8888
+    qdbus $msgbox setLabelText "Press cancel to end mod-ui" 
+    while true; do
+      qdbus $msgbox wasCancelled>/dev/null 2>&1 || break
+      sleep 5
+    done
+  fi
+}
+
+msgbox_close () {
+  if [ -z "$DISPLAY" ]; then
+    dialog --clear
+  else
+    qdbus $msgbox close
+  fi
+}
+
+kill_daemons () {
+  if [ -n "$MODUI_PID" ]; then
+    kill $MODUI_PID 2>/dev/null
+  fi
+  if [ -n "$LOADED" ]; then
+    jack_unload mod-monitor >/dev/null 2>&1
+  fi
+  if [ -n "$MODHOST_PID" ]; then
+    kill $MODHOST_PID 2>/dev/null
+  fi
+  if [ -n "$JACKD_PID" ]; then
+    kill $JACKD_PID 2>/dev/null
+  fi
+  msgbox_close
+}
+
+# Register a trap to stop the daemons.
+trap kill_daemons EXIT
+
+# Check whether we need to start dbus
+if [ -z "$DISPLAY" ]; then
+  DBUS_LAUNCH="dbus-run-session -- "
+fi
+
+# Set a sane LV2 plugin folder
+# ( N.B. mod-ui is picky about duplicates )
+if [ -z "$LV2_PATH" ]
+then
+  export LV2_PATH="$HOME/.lv2"
+fi
+
+msgbox_start
+
+# Start jackd if not running already
+PID=$(ps -o pid= -C jackd)
+if [ -z "$PID" ]; then
+  if [ -z "$JACKD_ARGS" ]; then
+    JACKD_ARGS="-R -d alsa -p 256 -n 1 -r 48000"
+  fi
+  ${DBUS_LAUNCH}jackd $JACKD_ARGS -D -n mod >/dev/null 2>&1 &
+  PID=$(ps -o pid= -C jackd)
+  #PID=$!
+  sleep 5
+  kill -0 $PID 2>/dev/null
+  if [ $? -ne 0 ]; then
+    exit 1
+  fi
+  JACKD_PID=$PID
+  echo $JACKD_PID > jackd_pid.txt
+fi
+
+msgbox_update 25
+
+# Start mod-host if not started already
+PID=$(ps -o pid= -C mod-host)
+if [ -z "$PID" ]
+then
+  mod-host -n -p 5555 -f 5556 >/dev/null 2>&1 &
+  PID=$!
+  sleep 3
+  kill -0 $PID 2>/dev/null
+  if [ $? -ne 0 ]
+  then
+    exit 1
+  fi
+  MODHOST_PID=$PID
+fi
+
+msgbox_update 50
+
+jack_load mod-monitor >/dev/null 2>&1
+LOADED="y"
+
+msgbox_update 75
+
+export MOD_DEV_ENVIRONMENT=0
+export MOD_LOG=0
+python3 /usr/lib64/python3.9/site-packages/mod-ui/server.py >/dev/null 2>&1 &
+PID=$!
+sleep 3
+kill -0 $PID 2>/dev/null
+if [ $? -ne 0 ]
+then
+  exit 1
+fi
+MODUI_PID=$!
+
+for x in `seq 1 10`
+do
+  nc -z -w5 localhost 8888 2>/dev/null && break
+  sleep 1
+done
+
+msgbox_update 100
+
+msgbox_wait
